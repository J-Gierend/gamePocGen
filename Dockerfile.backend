FROM node:22-slim

WORKDIR /app

COPY backend/package.json ./
RUN npm install --production

# Install Playwright for game testing in repair loop
COPY scripts/package.json /app/scripts/package.json
RUN cd /app/scripts && npm install
RUN npx playwright install chromium --with-deps

COPY backend/src/ ./src/
COPY scripts/ /app/scripts/

EXPOSE 3000

CMD ["node", "src/index.js"]
